<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js"></script>
    <!-- Include the "SignPainter" font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sign+Painter&display=swap" rel="stylesheet">
    <style>
        /* Set the background color of the webpage to black */
        body {
            background-color: black;
            margin: 0; /* Remove default body margin */
            padding: 0; /* Remove default body padding */
            overflow: hidden; /* Hide any potential scroll bars */
        }

        /* Style for the orange title with a larger font size at the bottom left of the page */
        #title {
            color: orange;
            text-align: left;
            font-size: 80px; /* Adjust the font size to make it larger */
            margin: 20px;
            position: absolute;
            bottom: 0;
            left: 0;
            font-family: 'Skia Black Extended', sans-serif; /* Use the "Skia Black Extended" font */
        }

        /* Style for the map container to fill the whole page */
        #map {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        /* Style for the logo at the top right of the page */
        #company-logo {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 200px; /* Adjust the width of the logo as needed */
            height: 200px; /* Adjust the height of the logo as needed */
            z-index: 1; /* Ensure the logo is on top of the map */
        }

        /* Style for the image at the bottom right of the map */
        #bottom-right-image {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px; /* Adjust the width of the image as needed */
            height: 200px; /* Adjust the height of the image as needed */
            z-index: 1; /* Ensure the image is on top of the map */
        }

        /* Style for the draggable image */
        .draggable-image {
            position: absolute;
            width: 100px; /* Adjust the width of the image as needed */
            height: 100px; /* Adjust the height of the image as needed */
            left: 25px;
            bottom: 50px;
            cursor: pointer;
            touch-action: none; /* Disable default touch behavior */
        }

        /* Style for the search container */
        #search-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 2;
        }

        /* Style for the search input */
        #search {
            width: 300px;
            padding: 10px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            outline: none;
            box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.2);
        }

        /* Add CSS for the pin container */
        .pin-container {
            position: absolute;
            width: 50px; /* Adjust the size of the clickable area */
            height: 50px; /* Adjust the size of the clickable area */
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        /* Add CSS for the modal container */
        .modal-container {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }

        /* Add CSS for the modal content */
        .modal-content {
            background-color: #000000;
            margin: 35% auto;
            padding: 20px;
            border: 3px solid white; /* Orange border color */
            width: 75%; /* Increase the modal width as needed */
            text-align: center;
            position: relative; /* Relative positioning for the close button */
            color: white;
            border-radius: 25px; /* Add rounded corners to the modal */
    
        }

        /* Style for the close button */
        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            cursor: pointer;
            color: #333; /* Close button color */
        }

        /* Style for the file input */
        .upload-photo {
            margin-top: 30px;
        }

        /* Adjust styles for mobile devices here */
        @media (max-width: 768px) {
            /* Adjust styles for mobile devices here */
            #company-logo {
                top: 10px;
                right: 10px;
                width: 100px;
                height: 100px;
            }

            #bottom-right-image {
                position: absolute;
                bottom: 10px;
                right: 10px;
                width: 100px;
                height: 100px;
            }

            #search-container {
                top: 10px;
                left: 10px;
            }

            #search {
                width: 200px;
                font-size: 14px;
            }

            /* Style for the draggable image */
            .draggable-image {
                position: absolute;
                width: 50px; /* Adjust the width of the image as needed */
                height: 50px; /* Adjust the height of the image as needed */
                left: 25px;
                bottom: 50px;
                cursor: pointer;
            }

            /* Adjust the font size for the slogan on mobile devices */
            #title {
                position: absolute;
                font-size: 24px; /* Adjust the font size for mobile */
            }

            /* Ensure the map container has a minimum height on smaller screens */
            #map {
                min-height: 300px; /* Adjust this value as needed */
            }
        }

        /* Adjust styles for mobile landscape devices here */
        @media (max-width: 1024px) and (orientation: landscape) {
            #company-logo {
                top: 10px;
                right: 10px;
                width: 80px;
                height: 80px;
            }

            #bottom-right-image {
                bottom: 10px;
                right: 10px;
                width: 80px;
                height: 80px;
            }

            #search {
                width: 200px;
                font-size: 14px;
            }

            .draggable-image {
                position: absolute;
                width: 60px;
                height: 60px;
                left: 25px;
                bottom: 50px;
                cursor: pointer;
            }
        }

        /* Adjust the font size for the slogan on mobile devices */
        #title {
            font-size: 24px; /* Adjust the font size for mobile */
        }

        
    </style>
</head>
<body>
    <div id="search-container">
        <input
            id="search"
            type="text"
            placeholder="Search for a place..."
        />
    </div>

    <img id="company-logo" src="Logo.png" alt="Company Logo"> <!-- Add your logo image URL and alt text -->
    <div id="map"></div>
    <div id="title">Track What You Pack</div> <!-- Add the orange title at the bottom left of the page -->
    <img id="bottom-right-image" src="Puffer.png" alt="Image"> <!-- Add your image URL and alt text -->

    <!-- Draggable Image -->
    <img class="draggable-image" src="Pin.png" alt="Draggable Image" draggable="true" id="draggable-image" style="left: 10px; bottom: 50px;">

    <script>
        // Your Mapbox Access Token
        mapboxgl.accessToken = 'pk.eyJ1IjoibXJtYXB6MzMiLCJhIjoiY2xtanBmNzZ4MDU1MTJrbDhmb3FxeW51NSJ9.pAVI4jVRkjQAQcu0xCUYqA';

        // Create a map instance
        var map = new mapboxgl.Map({
            container: 'map', // Specify the container ID
            style: 'mapbox://styles/mapbox/dark-v10', // Use the dark-v10 style for a black background
            center: [-99.3, 38], // Longitude and latitude of the initial map center (US center)
            zoom: 2 // Adjust the zoom level as needed
        });

        // Function to handle the search functionality
        document.getElementById("search").addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
                var searchText = e.target.value;
                geocode(searchText);
            }
        });

        // Function to geocode a location and fit the map to it
        function geocode(location) {
            fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${location}.json?access_token=${mapboxgl.accessToken}`)
                .then(response => response.json())
                .then(data => {
                    if (data.features.length > 0) {
                        var bbox = data.features[0].bbox; // Get the bounding box
                        map.fitBounds(bbox, { padding: 50 }); // Fit the map to the bounding box with padding
                    } else {
                        alert("Location not found!");
                    }
                })
                .catch(error => console.error(error));
        }

        // Define an array to store the dropped pins and their coordinates
        var droppedPins = [];

        // Function to show the custom modal dialog for a specific pin
        function showConfirmationModal(pinNumber) {
            const modalId = `confirmation-modal-${pinNumber}`;
            const modal = document.getElementById(modalId);
            modal.style.display = "block";

            // Handle the close button click
            modal.querySelector(".close-button").addEventListener("click", function () {
                modal.style.display = "none";
            });

            // Handle the file input change
            const fileInput = modal.querySelector(".upload-photo");
            const uploadedPhotoPreview = modal.querySelector(`#uploaded-photo-preview-${pinNumber}`);
            fileInput.addEventListener("change", function (event) {
                const selectedFile = fileInput.files[0];
                if (selectedFile) {
                    // Display the uploaded photo in the preview area
                    const reader = new FileReader();
                    reader.onload = function () {
                        uploadedPhotoPreview.src = reader.result;
                    };
                    reader.readAsDataURL(selectedFile);
                    // Disable the file input to prevent further uploads
                    fileInput.disabled = true;
                }
            });

            // Handle the "Yes" button click
            modal.querySelector(".confirm-delete").addEventListener("click", function () {
                modal.style.display = "none";
                // Get the pin number from the button's data attribute
                const pinToDelete = parseInt(this.getAttribute("data-pin"));
                deletePin(pinToDelete);
            });
        }

        // Function to create a new pin element
        function createPinElement(lng, lat, pinNumber) {
            // Create a pin container div
            const pinContainer = document.createElement("div");
            pinContainer.className = "pin-container";

            // Create the pin image
            const pinElement = new Image();
            pinElement.src = "Pin.png"; // Replace with your image URL
            pinElement.width = 35; // Adjust width as needed
            pinElement.height = 35; // Adjust height as needed

            // Add the pin image to the pin container
            pinContainer.appendChild(pinElement);

            // Set the position of the pin container
            pinContainer.style.position = "absolute";
            pinContainer.style.left = "0px"; // Pin is positioned on the map using mapbox
            pinContainer.style.top = "0px"; // Pin is positioned on the map using mapbox

            // Add the pin container to the map
            const pinMarker = new mapboxgl.Marker(pinContainer)
                .setLngLat([lng, lat])
                .addTo(map);

            // Add a click event listener to the pin container
            pinContainer.addEventListener("click", function () {
                showConfirmationModal(pinNumber);
            });

            // Create a modal container for the pin
            const modalId = `confirmation-modal-${pinNumber}`;
            const modalContainer = document.createElement("div");
            modalContainer.id = modalId;
            modalContainer.className = "modal-container";

            // Create the modal content
            const modalContent = document.createElement("div");
            modalContent.className = "modal-content";
            
            // Create and add the close button
            const closeButton = document.createElement("span");
            closeButton.className = "close-button";
            closeButton.setAttribute("data-modal", modalId);
            closeButton.innerHTML = "&times;";
            modalContent.appendChild(closeButton);

            // Create and add the uploaded photo preview
            const uploadedPhotoPreview = document.createElement("img");
            uploadedPhotoPreview.id = `uploaded-photo-preview-${pinNumber}`;
            uploadedPhotoPreview.src = "";

            uploadedPhotoPreview.style.maxWidth = "100%";
            uploadedPhotoPreview.style.maxHeight = "234px";
            modalContent.appendChild(uploadedPhotoPreview);

            // Create and add the file input
            const fileInput = document.createElement("input");
fileInput.type = "file";
fileInput.className = "upload-photo";
fileInput.accept = "image/*";
fileInput.style.marginLeft = "60px"; // Adjust the margin-left as needed
modalContent.appendChild(fileInput);

// Create and add the textarea for notes
const notesTextarea = document.createElement("textarea");
            notesTextarea.id = `notes-textarea-${pinNumber}`;
            notesTextarea.placeholder = "Add notes here...";
            notesTextarea.style.width = "75%";
            notesTextarea.style.height = "75px"; // Adjust the height as needed
            notesTextarea.style.resize = "none"; // Prevent textarea from being resized by users
            notesTextarea.style.marginTop = "50px"; // Add margin to the top of the textarea
            notesTextarea.style.marginBottom = "30px"; // Add margin to the top of the textarea
            modalContent.appendChild(notesTextarea);

            // Create and add the delete confirmation message
            const deleteMessage = document.createElement("p");
            deleteMessage.textContent = "Do you want to delete this?";
            modalContent.appendChild(deleteMessage);

            // Create and add the "Yes" button
            const confirmDeleteButton = document.createElement("button");
            confirmDeleteButton.className = "confirm-delete";
            confirmDeleteButton.setAttribute("data-pin", pinNumber);
            confirmDeleteButton.textContent = "Yes";
            modalContent.appendChild(confirmDeleteButton);

            // Append modal content to modal container
            modalContainer.appendChild(modalContent);

            // Append modal container to the body
            document.body.appendChild(modalContainer);

            return pinContainer;
        }

        // Function to delete a pin from the map and local storage
        function deletePin(pinNumber) {
            // Remove the pin from the map
            map.removeLayer(`pin-${pinNumber}`);

            // Remove the pin from the droppedPins array
            const index = droppedPins.findIndex(pin => pin.number === pinNumber);
            if (index !== -1) {
                droppedPins.splice(index, 1);
            }

            // Save the updated droppedPins array to local storage
            savePinsToLocalStorage();

            // Clear the uploaded photo preview
            const uploadedPhotoPreview = document.querySelector(`#uploaded-photo-preview-${pinNumber}`);
            uploadedPhotoPreview.src = "";

            // Remove the modal container from the DOM
            const modalId = `confirmation-modal-${pinNumber}`;
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.remove();
            }
        }

        // Function to set local storage with dropped pins
        function savePinsToLocalStorage() {
            localStorage.setItem("droppedPins", JSON.stringify(droppedPins));
        }

        // Function to load dropped pins from local storage
        function loadPinsFromLocalStorage() {
            var savedPins = localStorage.getItem("droppedPins");
            if (savedPins) {
                droppedPins = JSON.parse(savedPins);
                droppedPins.forEach(function (pin) {
                    createPinElement(pin.lngLat[0], pin.lngLat[1], pin.number);
                });
            }
        }

        // Touch event listeners for draggable image
        const draggableImage = document.getElementById("draggable-image");
        let offsetX, offsetY;

        // Function to handle touch start event
        function onTouchStart(event) {
            const touch = event.touches[0];
            offsetX = touch.clientX - draggableImage.getBoundingClientRect().left;
            offsetY = touch.clientY - draggableImage.getBoundingClientRect().top;
        }

        // Function to handle touch move event
        function onTouchMove(event) {
            event.preventDefault();
            const touch = event.touches[0];
            const x = touch.clientX - offsetX;
            const y = touch.clientY - offsetY;
            draggableImage.style.left = x + "px";
            draggableImage.style.top = y + "px";
        }

        // Function to handle touch end event
        function onTouchEnd(event) {
            // Get the final position of the draggable image
            const finalX = parseFloat(draggableImage.style.left);
            const finalY = parseFloat(draggableImage.style.top);

            // Calculate the geographic coordinates of the final position
            const lngLat = map.unproject([finalX, finalY]);

            // Create a new pin object to store the pin and its coordinates
            const newPin = {
                lngLat: [lngLat.lng, lngLat.lat],
                number: droppedPins.length + 1 // Assign a unique number to the pin
            };

            // Append the new pin to the droppedPins array
            droppedPins.push(newPin);

            // Create and add the pin element to the map
            const pinElement = createPinElement(lngLat.lng, lngLat.lat, newPin.number);

            // Save the droppedPins array to local storage
            savePinsToLocalStorage();

            // Reset the draggable image's position
            draggableImage.style.left = "10px";
            draggableImage.style.top = "50px";
        }

        // Add touch event listeners to the draggable image
        draggableImage.addEventListener("touchstart", onTouchStart);
        draggableImage.addEventListener("touchmove", onTouchMove);
        draggableImage.addEventListener("touchend", onTouchEnd);

        // Load dropped pins from local storage
        loadPinsFromLocalStorage();
    </script>
</body>
</html>
